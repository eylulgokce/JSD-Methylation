<!DOCTYPE html>
<!-- saved from url=(0038)file:///Users/eylul/Desktop/rp_p3.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shannon R Package - Publication Figure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Times New Roman', serif;
            line-height: 1.4;
            color: #000;
            background: white;
            padding: 20px;
        }
        
        .figure-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border: 1px solid #ccc;
            padding: 30px;
        }
        
        .figure-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: left;
        }
        
        .workflow-diagram {
            width: 100%;
            height: 500px;
            border: 1px solid #333;
            background: white;
            margin-bottom: 20px;
        }
        
        .panel-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .panel {
            border: 1px solid #333;
            padding: 15px;
            background: #f9f9f9;
        }
        
        .panel h3 {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }
        
        .function-list {
            font-size: 10px;
            line-height: 1.3;
        }
        
        .function-item {
            margin-bottom: 8px;
            padding-left: 15px;
            position: relative;
        }
        
        .function-item::before {
            content: "•";
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        
        .function-name {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        .figure-caption {
            font-size: 11px;
            line-height: 1.4;
            text-align: justify;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #ccc;
        }
        
        .caption-title {
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .methods-box {
            background: #f5f5f5;
            border: 1px solid #333;
            padding: 15px;
            margin-top: 15px;
            font-size: 10px;
        }
        
        .methods-title {
            font-weight: bold;
            font-size: 11px;
            margin-bottom: 8px;
        }
        
        .code-snippet {
            font-family: 'Courier New', monospace;
            background: #f0f0f0;
            padding: 8px;
            border: 1px solid #ccc;
            font-size: 9px;
            margin-top: 10px;
            line-height: 1.2;
        }
        
        @media print {
            body { 
                background: white; 
                padding: 10px;
            }
            .figure-container {
                border: none;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="figure-container">
        <div class="figure-title">
            Figure 9. Shannon R Package Architecture and Workflow for Information-Theoretic Analysis of Genomic Data
        </div>
        
        <!-- Main Workflow Diagram -->
        <svg class="workflow-diagram" viewBox="0 0 1000 450" xmlns="http://www.w3.org/2000/svg">
            <!-- Background -->
            <rect width="1000" height="450" fill="white" stroke="#000" stroke-width="1"></rect>
            
            <!-- Panel A: Data Input -->
            <text x="50" y="25" font-family="Arial" font-size="14" font-weight="bold">A</text>
            <rect x="70" y="40" width="200" height="120" fill="none" stroke="#000" stroke-width="1"></rect>
            <text x="170" y="55" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold">Data Input</text>
            
            <rect x="80" y="70" width="80" height="30" fill="#e3f2fd" stroke="#1976d2"></rect>
            <text x="120" y="87" text-anchor="middle" font-family="Arial" font-size="9">Tabix Files</text>
            <text x="120" y="95" text-anchor="middle" font-family="Arial" font-size="8">(.bed.gz)</text>
            
            <rect x="170" y="70" width="80" height="30" fill="#e8f5e8" stroke="#4caf50"></rect>
            <text x="210" y="87" text-anchor="middle" font-family="Arial" font-size="9">Metadata</text>
            <text x="210" y="95" text-anchor="middle" font-family="Arial" font-size="8">(.txt/.tsv)</text>
            
            <rect x="80" y="110" width="170" height="40" fill="#fff3e0" stroke="#ff9800"></rect>
            <text x="165" y="125" text-anchor="middle" font-family="Arial" font-size="9">Sample Configuration</text>
            <text x="165" y="135" text-anchor="middle" font-family="Arial" font-size="8">url, label, ID columns</text>
            <text x="165" y="143" text-anchor="middle" font-family="Arial" font-size="8">chrom, chunksize</text>
            
            <!-- Panel B: Processing Pipeline -->
            <text x="320" y="25" font-family="Arial" font-size="14" font-weight="bold">B</text>
            <rect x="340" y="40" width="280" height="120" fill="none" stroke="#000" stroke-width="1"></rect>
            <text x="480" y="55" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold">Processing Pipeline</text>
            
            <!-- Step 1 -->
            <rect x="350" y="70" width="80" height="25" fill="#f3e5f5" stroke="#9c27b0"></rect>
            <text x="390" y="85" text-anchor="middle" font-family="Arial" font-size="8">get_regions()</text>
            
            <!-- Step 2 -->
            <rect x="440" y="70" width="80" height="25" fill="#f3e5f5" stroke="#9c27b0"></rect>
            <text x="480" y="85" text-anchor="middle" font-family="Arial" font-size="8">get_data()</text>
            
            <!-- Step 3 -->
            <rect x="530" y="70" width="80" height="25" fill="#f3e5f5" stroke="#9c27b0"></rect>
            <text x="570" y="85" text-anchor="middle" font-family="Arial" font-size="8">js_divergence()</text>
            
            <!-- Processing details -->
            <rect x="350" y="105" width="260" height="45" fill="#f7f7f7" stroke="#666"></rect>
            <text x="480" y="118" text-anchor="middle" font-family="Arial" font-size="8">Quality Control Filters:</text>
            <text x="380" y="128" font-family="Arial" font-size="7">• Minimum sample size ≥ 2</text>
            <text x="380" y="136" font-family="Arial" font-size="7">• Minimum count ≥ 3</text>
            <text x="480" y="128" font-family="Arial" font-size="7">• Shannon entropy calculation</text>
            <text x="480" y="136" font-family="Arial" font-size="7">• Jensen-Shannon divergence</text>
            <!-- 
            <text x="580" y="128" font-family="Arial" font-size="7">• Coverage weighting</text>
            <text x="580" y="136" font-family="Arial" font-size="7">• Plug-in estimation</text>
            -->
            
            <!-- Panel C: Mathematical Framework -->
            <text x="50" y="200" font-family="Arial" font-size="14" font-weight="bold">C</text>
            <rect x="70" y="215" width="550" height="100" fill="none" stroke="#000" stroke-width="1"></rect>
            <text x="345" y="230" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold">Mathematical Framework</text>
            
            <!-- Shannon Entropy -->
            <text x="80" y="250" font-family="Arial" font-size="10" font-weight="bold">Shannon Entropy:</text>
            <text x="80" y="262" font-family="Arial" font-size="9">H(P) = -Σ p(k) log₂ p(k)</text>
            
            <!-- Jensen-Shannon Divergence -->
            <text x="250" y="250" font-family="Arial" font-size="10" font-weight="bold">Jensen-Shannon Divergence:</text>
            <text x="250" y="262" font-family="Arial" font-size="9">D(P) = H(⟨P⟩) - ⟨H⟩</text>
            <text x="250" y="272" font-family="Arial" font-size="8">where ⟨P⟩ = Σ πⱼPⱼ</text>
            
            <!-- Implementation -->
            <text x="480" y="250" font-family="Arial" font-size="10" font-weight="bold">Plug-in Estimator:</text>
            <text x="480" y="262" font-family="Arial" font-size="9">Pᵢⱼ = (nᵢⱼ₁, nᵢⱼ₂)/nᵢⱼ</text>
            <text x="480" y="272" font-family="Arial" font-size="8">πᵢⱼ = nᵢⱼ/nᵢ (coverage weights)</text>
            
            <!-- Quality metrics -->
            <text x="80" y="290" font-family="Arial" font-size="9">Quality Control: Sample size, minimum counts, coverage thresholds</text>
            <text x="80" y="300" font-family="Arial" font-size="9">Output: JSD_bit_, HMIX_bit_, sample_size, methylated/unmethylated counts</text>
            
            <!-- Panel D: Output -->
            <text x="680" y="25" font-family="Arial" font-size="14" font-weight="bold">D</text>
            <rect x="700" y="40" width="250" height="120" fill="none" stroke="#000" stroke-width="1"></rect>
            <text x="825" y="55" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold">Output Results</text>
            
            <rect x="710" y="70" width="110" height="80" fill="#e1f5fe" stroke="#0288d1"></rect>
            <text x="765" y="85" text-anchor="middle" font-family="Arial" font-size="9" font-weight="bold">Per-position metrics:</text>
            <text x="720" y="98" font-family="Arial" font-size="8">• JSD_bit_</text>
            <text x="720" y="108" font-family="Arial" font-size="8">• HMIX_bit_</text>
            <text x="720" y="118" font-family="Arial" font-size="8">• sample_size</text>
            <text x="720" y="128" font-family="Arial" font-size="8">• methylated counts</text>
            <text x="720" y="138" font-family="Arial" font-size="8">• unmethylated counts</text>
            
            <rect x="830" y="70" width="110" height="80" fill="#f1f8e9" stroke="#689f38"></rect>
            <text x="885" y="85" text-anchor="middle" font-family="Arial" font-size="9" font-weight="bold">File formats:</text>
            <text x="840" y="98" font-family="Arial" font-size="8">• Tab-separated</text>
            <text x="840" y="108" font-family="Arial" font-size="8">• Genomic coordinates</text>
            <text x="840" y="118" font-family="Arial" font-size="8">• Header included</text>
            <text x="840" y="128" font-family="Arial" font-size="8">• Append mode</text>
            <text x="840" y="138" font-family="Arial" font-size="8">• Progress tracking</text>
            
            <!-- Arrows -->
            <path d="M 270 100 L 335 85" stroke="#000" stroke-width="2" fill="none" marker-end="url(#arrowhead)"></path>
            <path d="M 620 85 L 695 85" stroke="#000" stroke-width="2" fill="none" marker-end="url(#arrowhead)"></path>
            <path d="M 345 180 L 345 210" stroke="#000" stroke-width="2" fill="none" marker-end="url(#arrowhead)"></path>
            
            <!-- Arrow marker -->
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#000"></polygon>
                </marker>
            </defs>
            
            <!-- Module Organization -->
            <text x="50" y="360" font-family="Arial" font-size="14" font-weight="bold">E</text>
            <rect x="70" y="375" width="880" height="60" fill="none" stroke="#000" stroke-width="1"></rect>
            <text x="510" y="390" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold">Package Organization</text>
            
            <rect x="80" y="400" width="100" height="25" fill="#ffe0e0" stroke="#d32f2f"></rect>
            <text x="130" y="415" text-anchor="middle" font-family="Arial" font-size="8">core.R</text>
            
            <rect x="190" y="400" width="100" height="25" fill="#e0f0ff" stroke="#1976d2"></rect>
            <text x="240" y="415" text-anchor="middle" font-family="Arial" font-size="8">estimators.R</text>
            
            <rect x="300" y="400" width="100" height="25" fill="#e0ffe0" stroke="#388e3c"></rect>
            <text x="350" y="415" text-anchor="middle" font-family="Arial" font-size="8">gpf_utils.R</text>
            
            <rect x="410" y="400" width="100" height="25" fill="#fff0e0" stroke="#f57c00"></rect>
            <text x="460" y="415" text-anchor="middle" font-family="Arial" font-size="8">io.R</text>
            
            <rect x="520" y="400" width="100" height="25" fill="#f0e0ff" stroke="#7b1fa2"></rect>
            <text x="570" y="415" text-anchor="middle" font-family="Arial" font-size="8">preprocessing.R</text>
            
            <rect x="630" y="400" width="100" height="25" fill="#e0f8ff" stroke="#0097a7"></rect>
            <text x="680" y="415" text-anchor="middle" font-family="Arial" font-size="8">constants.R</text>
            
            <rect x="740" y="400" width="100" height="25" fill="#f8f0e0" stroke="#5d4037"></rect>
            <text x="790" y="415" text-anchor="middle" font-family="Arial" font-size="8">shannon.R</text>
            
            <rect x="850" y="400" width="90" height="25" fill="#f0f0f0" stroke="#616161"></rect>
            <text x="895" y="415" text-anchor="middle" font-family="Arial" font-size="8">Dependencies</text>
        </svg>
        
        <!-- Function Details Panels -->
        <div class="panel-container">
            <div class="panel">
                <h3>Core Functions</h3>
                <div class="function-list">
                    <div class="function-item">
                        <span class="function-name">divergence()</span> - Main analysis function for computing Jensen-Shannon divergence across genomic positions with chunk-based processing
                    </div>
                    <div class="function-item">
                        <span class="function-name">js_divergence()</span> - Calculate Jensen-Shannon divergence with integrated quality control and coverage weighting
                    </div>
                    <div class="function-item">
                        <span class="function-name">shannon_entropy()</span> - Compute Shannon entropy using plug-in estimator for methylation count matrices
                    </div>
                    <div class="function-item">
                        <span class="function-name">get_regions()</span> - Generate optimized genomic regions for memory-efficient chunk-based processing
                    </div>
                    <div class="function-item">
                        <span class="function-name">get_data()</span> - Extract and merge multi-sample data from tabix-indexed genomic position files
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <h3>Technical Specifications</h3>
                <div class="function-list">
                    <div class="function-item">
                        <strong>Input Format:</strong> Tabix-indexed BED files (.bed.gz + .tbi), metadata with required ID/url/label columns
                    </div>
                    <div class="function-item">
                        <strong>Quality Control:</strong> Minimum sample size (≥2), minimum count threshold (≥3), coverage filters
                    </div>
                    <div class="function-item">
                        <strong>Mathematical Basis:</strong> Plug-in Shannon entropy estimator, coverage-weighted Jensen-Shannon divergence
                    </div>
                    <div class="function-item">
                        <strong>Scalability:</strong> Chunk-based processing, configurable memory usage, progress tracking
                    </div>
                    <div class="function-item">
                        <strong>Dependencies:</strong> Rsamtools, data.table, GenomicRanges, IRanges, Bioconductor ecosystem
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Methods Box -->
        <div class="methods-box">
            <div class="methods-title">Implementation Example</div>
            <div class="code-snippet">
# Load shannon package and define sample metadata
library(shannon)
sample_data &lt;- data.frame(
  ID = c("sample1", "sample2", "sample3"),
  url = c("sample1.bed.gz", "sample2.bed.gz", "sample3.bed.gz"),
  label = c("S1", "S2", "S3")
)

# Execute divergence analysis with quality control
result &lt;- divergence(sample = sample_data, chrom = "chr1", 
                    data_columns = list(c(4,5)), outfile = "chr1_jsd.txt", 
                    chunksize = 1000, min_samplesize = 2, min_count = 3)

# Output: Genomic positions with JSD_bit_, HMIX_bit_, sample_size, and count data
            </div>
        </div>
        
        <!-- Figure Caption -->
        <div class="figure-caption">
            <div class="caption-title">Figure 1. Shannon R Package Architecture and Workflow for Information-Theoretic Analysis of Genomic Data.</div>
            <strong>(A)</strong> Data input layer accepts tabix-indexed BED files containing genomic position data and associated metadata tables specifying sample configurations, chromosomal regions, and analysis parameters. 
            <strong>(B)</strong> The processing pipeline implements a three-stage workflow: region chunking for memory efficiency, data extraction and merging across samples, and Jensen-Shannon divergence calculation with integrated quality control filters. 
            <strong>(C)</strong> Mathematical framework based on information theory, implementing plug-in Shannon entropy estimation and coverage-weighted Jensen-Shannon divergence calculations with bit conversion for interpretability. 
            <strong>(D)</strong> Output generation produces per-position metrics including JSD values, mixture entropy, sample sizes, and methylated/unmethylated count matrices in tab-separated format with genomic coordinates. 
            <strong>(E)</strong> Package organization across seven core modules providing data input/output, preprocessing utilities, entropy estimation, divergence calculation, and genomic data manipulation functions. The package implements robust quality control with configurable thresholds for minimum sample size (≥2) and coverage (≥3 counts), ensuring statistical reliability of information-theoretic measures. Designed for DNA methylation diversity analysis using the plug-in estimator of Jensen-Shannon divergence as described in the original methodology.
        </div>
    </div>

</body></html>